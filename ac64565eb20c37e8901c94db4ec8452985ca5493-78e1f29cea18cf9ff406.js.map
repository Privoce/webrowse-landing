{"version":3,"file":"ac64565eb20c37e8901c94db4ec8452985ca5493-78e1f29cea18cf9ff406.js","mappings":"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","sources":["webpack://webrowse-landing/./src/hooks/useAgora.js","webpack://webrowse-landing/./src/pages/voice/Meeting.js","webpack://webrowse-landing/./src/utils/index.js","webpack://webrowse-landing/./src/pages/voice/components/RoomFooter/Buttons.js","webpack://webrowse-landing/./src/pages/voice/components/RoomFooter/index.js","webpack://webrowse-landing/./src/pages/voice/components/RoomFooter/styles.js","webpack://webrowse-landing/./src/pages/voice/components/Users/index.js","webpack://webrowse-landing/./src/pages/voice/components/Users/styles.js","webpack://webrowse-landing/./src/pages/voice/styles.js"],"sourcesContent":["/**\n * @author: laoona\n * @date:  2022-02-14\n * @time: 14:42\n * @contact: laoona.com\n * @description: #\n */\n\nimport {useState, useEffect, useCallback} from 'react';\nimport AgoraRTC from 'agora-rtc-sdk-ng';\n\nconst APPID = '733ebd8906c84f8baafcbf548dcfe7da';\n\nexport default function useAgora(client) {\n  const [localVideoTrack, setLocalVideoTrack] = useState(undefined);\n  const [localAudioTrack, setLocalAudioTrack] = useState(undefined);\n  const [devices, setDevices] = useState([]);\n  const [channel, setChannel] = useState('');\n  const [intId, setIntId] = useState(null);\n\n  const [joinState, setJoinState] = useState(false);\n\n  const [remoteUsers, setRemoteUsers] = useState([]);\n  const [volumes, setVolumes] = useState([])\n\n  const getToken = async (id, channel) => {\n    const res =  await fetch(`https://wechat.okeydemo.com/api/agora/get_token?uid=${id}&channel=${channel}`);\n\n    return await res.text();\n  };\n\n  async function createLocalTracks(audioConfig, videoConfig) {\n    const [microphoneTrack, cameraTrack] = await AgoraRTC.createMicrophoneAndCameraTracks(audioConfig, videoConfig);\n\n    setLocalAudioTrack(microphoneTrack);\n    setLocalVideoTrack(cameraTrack);\n    return [microphoneTrack, cameraTrack];\n  }\n\n  useEffect(() => {\n    if (!client) return;\n\n    (async () => {\n      // console.log(await AgoraRTC.getMicrophones(true), 'haha', client);\n      const devices = await AgoraRTC.getDevices();\n      setDevices(devices);\n    })();\n\n  }, [client]);\n\n  const join = useCallback(async function (\n    channel, intId, audioConfig, videoConfig) {\n\n    if (!client || !intId) return;\n    client.enableAudioVolumeIndicator();\n    setIntId(intId);\n    setChannel(channel);\n\n    const token = await getToken(intId, channel);\n    const [microphoneTrack, cameraTrack] = await createLocalTracks(\n      audioConfig, videoConfig);\n\n    await client.join(APPID, channel, token || null, +intId);\n    await client.publish([microphoneTrack, cameraTrack]);\n\n    window.client = client;\n    window.videoTrack = cameraTrack;\n\n    setJoinState(true);\n  }, []);\n\n  async function leave() {\n    if (localAudioTrack) {\n      localAudioTrack.stop();\n      localAudioTrack.close();\n    }\n    if (localVideoTrack) {\n      localVideoTrack.stop();\n      localVideoTrack.close();\n    }\n    setRemoteUsers([]);\n    setJoinState(false);\n    await client?.leave();\n  }\n\n  useEffect(() => {\n    if (!client) return;\n    setRemoteUsers(client.remoteUsers);\n\n    const handleUserPublished = async (user, mediaType) => {\n      await client.subscribe(user, mediaType);\n      // toggle rerender while state of remoteUsers changed.\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserUnpublished = (user) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserJoined = (user) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserLeft = (user) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n\n    client.on('user-published', handleUserPublished);\n    client.on('user-unpublished', handleUserUnpublished);\n    client.on('user-joined', handleUserJoined);\n    client.on('user-left', handleUserLeft);\n\n    return () => {\n      client.off('user-published', handleUserPublished);\n      client.off('user-unpublished', handleUserUnpublished);\n      client.off('user-joined', handleUserJoined);\n      client.off('user-left', handleUserLeft);\n    };\n  }, [client]);\n\n  useEffect(() => {\n    if (!client || !channel || !intId) return;\n\n    const handleTokenPrivilegeWillExpire = async () => {\n      console.log('WillExpire');\n      const token = await getToken(intId, channel);\n      await client.renewToken(token);\n    };\n\n    const handleTokenPrivilegeDidExpire = async () => {\n      console.log(\"Fetching the new Token\")\n      const token = await getToken(intId, channel);\n      console.log(\"Rejoining the channel with new Token\")\n      await client.join(APPID, channel, token, intId);\n    };\n\n    const handleVolumeIndicator = (volumes) => {\n      setVolumes(volumes);\n\n      volumes.forEach((volume, index) => {\n        console.log(`${index} UID ${volume.uid} Level ${volume.level}`);\n      });\n    };\n    // 收到 token-privilege-will-expire 回调时，从服务器重新申请一个 Token，并调用 renewToken 将新的 Token 传给 SDK\n    client.on(\"token-privilege-will-expire\", handleTokenPrivilegeWillExpire);\n\n    // 收到 token-privilege-did-expire 回调时，从服务器重新申请一个 Token，并调用 join 重新加入频道\n    client.on(\"token-privilege-did-expire\", handleTokenPrivilegeDidExpire);\n\n    client.on(\"volume-indicator\", handleVolumeIndicator);\n\n    return () => {\n      client.off(\"token-privilege-will-expire\", handleTokenPrivilegeWillExpire);\n      client.off(\"token-privilege-did-expire\", handleTokenPrivilegeDidExpire);\n      client.off(\"volume-indicator\", handleVolumeIndicator);\n    }\n  }, [client, channel, intId]);\n\n  return {\n    localAudioTrack,\n    localVideoTrack,\n    joinState,\n    leave,\n    join,\n    remoteUsers,\n    devices,\n    volumes,\n  };\n}\n","/**\n * @author: laoona\n * @date:  2022-03-21\n * @time: 19:06\n * @contact: laoona.com\n * @description: #\n */\n\nimport React, { useEffect, useState, useContext } from \"react\"\n\nimport AgoraRTC from \"agora-rtc-sdk-ng\"\nimport useAgora from \"../../hooks/useAgora\"\nimport RoomFooter from \"./components/RoomFooter\"\nimport StyledWrapper from \"./styles\"\nimport Users from \"./components/Users\"\nimport {\n  VoiceContext,\n  UPDATE_LOCAL_VIDEO_TRACK,\n  UPDATE_LOCAL_AUDIO_TRACK,\n  UPDATE_JOIN_STATE,\n  UPDATE_USERS,\n  UPDATE_CLIENT,\n  UPDATE_STATUS,\n} from \"./reducer\"\nimport { JoinRoom } from \"./components/Icon\"\nimport { isBrowser } from \"../../utils\"\n\nconst client = AgoraRTC?.createClient?.({ codec: \"h264\", mode: \"rtc\" })\n\n/**\n * 随机生成uid\n * @returns {number}\n */\nconst genUid = () => {\n  const soup = \"123456789\"\n  const length = 9\n  const soupLength = soup.length\n  const id = []\n  for (let i = 0; i < length; i++) {\n    id[i] = soup.charAt(Math.random() * soupLength)\n  }\n\n  return +id.join(\"\")\n}\n\nconst Meeting = () => {\n  const { dispatch, state } = useContext(VoiceContext)\n\n  const { status, cameraId, microphoneId, currentUser } = state || {}\n\n  const params = new URLSearchParams(isBrowser() ? window.location.search : '')\n  const uid = currentUser?.intUid || genUid() || +params.get(\"uid\") || 1\n  const cid = params.get(\"cid\") || \"test\"\n\n  const {\n    localAudioTrack,\n    localVideoTrack,\n    join,\n    joinState,\n    remoteUsers,\n  } = useAgora(client, uid)\n\n  useEffect(() => {\n    dispatch({\n      type: UPDATE_CLIENT,\n      payload: client,\n    })\n  }, [])\n\n  useEffect(() => {\n    if (!uid || !cid) return\n    // join(cid, uid);\n  }, [uid, cid])\n\n  useEffect(() => {\n    if (!localVideoTrack || !localAudioTrack) return\n\n    dispatch({\n      type: UPDATE_LOCAL_VIDEO_TRACK,\n      payload: localVideoTrack,\n    })\n\n    dispatch({\n      type: UPDATE_LOCAL_AUDIO_TRACK,\n      payload: localAudioTrack,\n    })\n  }, [localVideoTrack, localAudioTrack])\n\n  useEffect(() => {\n    dispatch({\n      type: UPDATE_JOIN_STATE,\n      payload: joinState,\n    })\n  }, [joinState])\n\n  useEffect(() => {\n    const message = {\n      source: \"webrow.se/voice\",\n      payload: {\n        status: state?.status,\n      },\n      event: \"connect\",\n    }\n\n    // 向扩展发送连接消息\n    window?.postMessage(message, \"*\")\n  }, [state?.status])\n\n  useEffect(() => {\n    (async () => {\n      if (state?.status === 'will-join') {\n        await handleJoin({microphoneId}, {cameraId})\n      }\n    })();\n  }, [state?.status, cameraId, microphoneId]);\n\n  useEffect(() => {\n    dispatch({\n      type: UPDATE_USERS,\n      payload: remoteUsers,\n    })\n\n    const message = {\n      source: \"webrow.se/voice\",\n      payload: {\n        remoteUsers: remoteUsers.map(item => ({uid: item.uid})),\n      },\n      event: \"remote_users\",\n    }\n\n    // 向扩展发送连接消息\n    window?.postMessage(message, \"*\")\n  }, [remoteUsers])\n\n/*\n  if (!state?.joinState && state?.status === 'disconnected') {\n    await handleJoin({microphoneId}, {cameraId});\n  }\n*/\n\n  const handleJoin = async (audioConfig, videoConfig) => {\n    dispatch({\n      type: UPDATE_STATUS,\n      payload: \"connecting\",\n    })\n\n    await join(cid, uid, audioConfig, videoConfig)\n\n    dispatch({\n      type: UPDATE_JOIN_STATE,\n      payload: true,\n    })\n\n    dispatch({\n      type: UPDATE_STATUS,\n      payload: \"connected\",\n    })\n  }\n\n  return (\n    <StyledWrapper>\n      <header className=\"header\">\n        <h1 className=\"title\">Webrowse</h1>\n        <h2 className=\"sub_title\">\n          Sync tabs with your teammates!\n        </h2>\n      </header>\n\n      {\n        state?.joinState ? <>\n            <Users />\n            <RoomFooter />\n          </>\n          :\n          <div className=\"joinWrap\">\n            <button\n              disabled={status === \"connecting\"}\n              className=\"button\"\n              onClick={() => handleJoin({microphoneId},\n                {cameraId})}\n            >\n              <div className=\"inner\">\n                <JoinRoom />\n              </div>\n              {status === \"connecting\" ? \"connecting\" : \"Join\"}\n            </button>\n          </div>\n      }\n\n    </StyledWrapper>\n  )\n}\n\nexport default Meeting\n","/**\n * @author: laoona\n * @date:  2022-03-25\n * @time: 23:10\n * @contact: laoono.com\n * @description: #\n */\n\nexport const isBrowser = () => typeof window !== \"undefined\"\n","/**\n * @author: laoona\n * @date:  2022-03-18\n * @time: 16:47\n * @contact: laoona.com\n * @description: #\n */\n\nimport React, { useContext, useState, useEffect } from \"react\"\nimport styled from \"styled-components\"\nimport { VoiceContext, LEAVE, UPDATE_DEVICES_ENABLED } from \"../../reducer\"\nimport { Video, Audio, VideoClose, AudioClose, Exit } from \"../Icon\"\n// import Button from \"./Button\"\n\nconst StyledWrap = styled.div`\n  .buttonMain {\n\n  }\n\n  .button {\n    border: none;\n    background: none;\n    cursor: pointer;\n\n    &:disabled {\n      opacity: 0.3;\n    }\n\n    &Icon {\n      width: 48px;\n      height: 48px;\n      background-color: #f26b4d;\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n\n      &:hover {\n        background-color: #c35037;\n      }\n    }\n\n    .text {\n      color: #fff;\n      font-size: 14px;\n      margin-top: 10px;\n      text-align: center;\n    }\n\n    &Inner {\n    }\n  }\n`\n\nconst Buttons = () => {\n  const { state, dispatch } = useContext(VoiceContext) || {}\n  const {\n    localVideoTrack,\n    localAudioTrack,\n    videoEnabled,\n    audioEnabled,\n    joinState\n  } = state || {}\n\n  const handleEnabled = (type = \"video\") => {\n    const enabled = type === 'video' ? videoEnabled : audioEnabled;\n\n    dispatch({\n      type: UPDATE_DEVICES_ENABLED,\n      payload: {\n        devices: type,\n        enabled: !enabled,\n      }\n    })\n  }\n\n  const handleLeave = () => {\n    dispatch({\n      type: LEAVE,\n    })\n  }\n\n  useEffect(() => {\n    localVideoTrack?.setMuted(!videoEnabled)\n  }, [videoEnabled])\n\n  useEffect(() => {\n    localAudioTrack?.setMuted(!audioEnabled)\n  }, [audioEnabled])\n\n  return <StyledWrap>\n    <button\n      onClick={() => handleEnabled()}\n      className={\"button\"}\n    >\n      <div className={\"buttonInner\"}>\n        <div className={\"buttonIcon\"}>\n          {videoEnabled ? <Video /> : <VideoClose />}\n        </div>\n        <div className={\"text\"}>Cam</div>\n      </div>\n    </button>\n\n{/*\n    <Button\n      onClick={() => handleEnabled(\"audio\")}\n    />\n*/}\n    <button\n      onClick={() => handleEnabled(\"audio\")}\n      className={\"button\"}\n    >\n      <div className={\"buttonInner\"}>\n        <div className={\"buttonIcon\"}>\n          {audioEnabled ? <Audio /> : <AudioClose />}\n        </div>\n        <div className={\"text\"}>Mic</div>\n      </div>\n    </button>\n\n    <button\n      disabled={!joinState}\n      onClick={handleLeave}\n      className={\"button\"}\n    >\n      <div className={\"buttonInner\"}>\n        <div className={\"buttonIcon\"}>\n          <Exit />\n        </div>\n        <div className={\"text\"}>Leave</div>\n      </div>\n    </button>\n  </StyledWrap>\n}\n\nexport default Buttons\n","/**\n * @author: laoona\n * @date:  2022-03-18\n * @time: 16:26\n * @contact: laoona.com\n * @description: #\n */\nimport React from 'react';\nimport StyledWrapper from \"./styles\";\nimport Buttons from \"./Buttons\";\n\nconst RoomFooter = () => {\n  return <StyledWrapper>\n    <Buttons/>\n  </StyledWrapper>\n};\n\nexport default RoomFooter;\n","/**\n * @author: laoona\n * @date:  2022-03-18\n * @time: 16:43\n * @contact: laoona.com\n * @description: #\n */\nimport styled from 'styled-components';\n\nconst StyledWrapper = styled.footer`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 10px;\n  `;\n\nexport default StyledWrapper;\n\n","/**\n * @author: laoona\n * @date:  2022-03-18\n * @time: 17:02\n * @contact: laoona.com\n * @description: #\n */\n\nimport React, { useContext } from \"react\"\nimport StyledWrapper from \"./styles\"\nimport MediaPlayer from \"../MediaPlayer\"\nimport { VoiceContext } from \"../../reducer\"\n\nconst Users = () => {\n  const { state = {} } = useContext(VoiceContext)\n  const { localVideoTrack, users, currentUser, extUsers } = state\n\n  return <StyledWrapper>\n    <ul className={`users ${users?.length > 1 ? \"usersMore\" : \"\"}`}>\n      <li className=\"user\">\n        <MediaPlayer videoTrack={localVideoTrack} audioTrack={undefined} />\n        <div className=\"info\">\n          <div className=\"avatar\"><img src={currentUser?.photo} className=\"pic\" alt=\"\" /></div>\n          {/*<div className=\"name\">{user.username}</div>*/}\n        </div>\n      </li>\n      {\n        users?.map(user =>\n          <li key={user.uid} className=\"user\">\n            {/*(user.hasVideo || user.hasAudio) ?*/}\n            <MediaPlayer videoTrack={user.videoTrack} audioTrack={user.audioTrack} />\n            {/*:*/}\n            <div className=\"info\">\n              <div className=\"avatar\">\n                <img src={extUsers.find(item => item.intUid === user.uid)?.photo} className=\"pic\" alt=\"\" /></div>\n              {/*<div className=\"name\">{user.username}</div>*/}\n            </div>\n          </li>\n        )\n      }\n    </ul>\n  </StyledWrapper>\n}\n\nexport default Users\n","/**\n * @author: laoona\n * @date:  2022-03-18\n * @time: 17:02\n * @contact: laoona.com\n * @description: #\n */\n\nimport styled from 'styled-components';\n\nconst StyledWrapper = styled.div`\n  display: flex;\n  height: 100%;\n  align-items: center;\n  justify-content: center;\n  .users {\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: center;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 0;\n    width: 100%;\n    &More {\n      .player {\n        width: 320px;\n        height: 240px;\n      } \n    }\n  }\n  .user {\n    position: relative;\n  }\n  .info {\n    position: absolute; \n    bottom: 0;\n    right: 0;\n  }\n  .avatar {\n    width: 80px;\n    height: 80px;\n    background-color: #333;\n    opacity: 0.75;\n    //border-radius: 8px;\n    overflow: hidden;\n    .pic {\n      width: 100%;\n      height: 100%;\n    }\n  }\n  .name {\n    color: #fff;\n    margin-top: 4px;\n    text-align: center;\n    font-size: 14px;\n  }\n  `;\n\nexport default StyledWrapper;\n","/**\n * @author: laoona\n * @date:  2022-03-18\n * @time: 16:29\n * @contact: laoona.com\n * @description: #\n */\n\nimport styled from \"styled-components\"\n\nconst StyledWrapper = styled.section`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: column;\n  justify-content: space-between;\n  background-color: #19181D;\n\n  .header {\n    display: flex;\n    //flex-direction: column;\n    align-items: center;\n    padding: 15px;\n    justify-content: center;\n\n    .title {\n      color: #056CF2;\n      font-style: normal;\n      font-weight: 800;\n      font-size: 36px;\n      line-height: 139.8%;\n      padding-left: 60px;\n      background-image: url('https://static.nicegoodthings.com/project/ext/webrowse.logo.v2.png');\n      background-size: contain;\n      background-repeat: no-repeat;\n      margin-bottom: 0;\n    }\n\n    .sub_title {\n      display: none;\n      color: #606368;\n      font-weight: normal;\n      font-size: 24px;\n      line-height: 139.8%;\n      margin-bottom: 0;\n      margin-left: 10px;\n    }\n  }\n  .joinWrap {\n    position: absolute;\n    z-index: 1;\n    width: 100vw;\n    height: 100vh;\n    background-color: rgba(0, 0, 0, .5);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #fff;\n    .button {\n      display: flex;\n      align-items: center;\n      cursor: pointer;\n      border: none; \n      //background-color: transparent;\n      background-color: #f26b4d;\n      padding: 4px 20px;\n      border-radius: 12px;\n      gap: 10px;\n      font-size: 16px;\n      &:hover {\n        background-color: #c35037;\n      }\n    }\n    .inner {\n    }\n  }\n`\n\nexport default StyledWrapper\n"],"names":["APPID","client","AgoraRTC","codec","mode","useContext","VoiceContext","dispatch","state","status","cameraId","microphoneId","currentUser","params","URLSearchParams","window","location","search","uid","intUid","soup","soupLength","length","id","i","charAt","Math","random","join","genUid","get","cid","useState","undefined","localVideoTrack","setLocalVideoTrack","localAudioTrack","setLocalAudioTrack","devices","setDevices","channel","setChannel","intId","setIntId","joinState","setJoinState","remoteUsers","setRemoteUsers","volumes","setVolumes","getToken","fetch","res","text","createLocalTracks","audioConfig","videoConfig","microphoneTrack","cameraTrack","useEffect","useCallback","enableAudioVolumeIndicator","token","publish","videoTrack","stop","close","leave","handleUserPublished","user","mediaType","subscribe","Array","from","handleUserUnpublished","handleUserJoined","handleUserLeft","on","off","handleTokenPrivilegeWillExpire","console","log","renewToken","handleTokenPrivilegeDidExpire","handleVolumeIndicator","forEach","volume","index","level","useAgora","type","UPDATE_CLIENT","payload","UPDATE_LOCAL_VIDEO_TRACK","UPDATE_LOCAL_AUDIO_TRACK","UPDATE_JOIN_STATE","message","source","event","postMessage","handleJoin","UPDATE_USERS","map","item","UPDATE_STATUS","className","Users","RoomFooter","disabled","onClick","JoinRoom","StyledWrap","styled","videoEnabled","audioEnabled","handleEnabled","enabled","UPDATE_DEVICES_ENABLED","setMuted","Video","VideoClose","Audio","AudioClose","LEAVE","Exit","StyledWrapper","users","extUsers","audioTrack","src","photo","alt","key","find"],"sourceRoot":""}