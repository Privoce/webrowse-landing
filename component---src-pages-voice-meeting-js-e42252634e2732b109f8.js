"use strict";(self.webpackChunkwebrowse_landing=self.webpackChunkwebrowse_landing||[]).push([[8091,3615,3754,299],{7289:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var a=n(7294),o=n(6963),l=n.n(o);const i="733ebd8906c84f8baafcbf548dcfe7da";function r(e){const{0:t,1:n}=(0,a.useState)(void 0),{0:o,1:r}=(0,a.useState)(void 0),{0:c,1:s}=(0,a.useState)([]),{0:d,1:u}=(0,a.useState)(""),{0:m,1:f}=(0,a.useState)(null),{0:p,1:v}=(0,a.useState)(!1),{0:E,1:h}=(0,a.useState)([]),{0:g,1:b}=(0,a.useState)([]),y=async(e,t)=>{const n=await fetch("https://wechat.okeydemo.com/api/agora/get_token?uid="+e+"&channel="+t);return await n.text()};(0,a.useEffect)((()=>{e&&(async()=>{const e=await l().getDevices();s(e)})()}),[e]);const w=(0,a.useCallback)((async function(t,a,o,c){if(!e||!a)return;e.enableAudioVolumeIndicator(),f(a),u(t);const s=await y(a,t),[d,m]=await async function(e,t){const[a,o]=await l().createMicrophoneAndCameraTracks(e,t);return r(a),n(o),[a,o]}(o,c);await e.join(i,t,s||null,+a),await e.publish([d,m]),window.client=e,window.videoTrack=m,v(!0)}),[]);return(0,a.useEffect)((()=>{if(!e)return;h(e.remoteUsers);const t=async(t,n)=>{await e.subscribe(t,n),h((t=>Array.from(e.remoteUsers)))},n=t=>{h((t=>Array.from(e.remoteUsers)))},a=t=>{h((t=>Array.from(e.remoteUsers)))},o=t=>{h((t=>Array.from(e.remoteUsers)))};return e.on("user-published",t),e.on("user-unpublished",n),e.on("user-joined",a),e.on("user-left",o),()=>{e.off("user-published",t),e.off("user-unpublished",n),e.off("user-joined",a),e.off("user-left",o)}}),[e]),(0,a.useEffect)((()=>{if(!e||!d||!m)return;const t=async()=>{console.log("WillExpire");const t=await y(m,d);await e.renewToken(t)},n=async()=>{console.log("Fetching the new Token");const t=await y(m,d);console.log("Rejoining the channel with new Token"),await e.join(i,d,t,m)},a=e=>{b(e),e.forEach(((e,t)=>{console.log(t+" UID "+e.uid+" Level "+e.level)}))};return e.on("token-privilege-will-expire",t),e.on("token-privilege-did-expire",n),e.on("volume-indicator",a),()=>{e.off("token-privilege-will-expire",t),e.off("token-privilege-did-expire",n),e.off("volume-indicator",a)}}),[e,d,m]),{localAudioTrack:o,localVideoTrack:t,joinState:p,leave:async function(){o&&(o.stop(),o.close()),t&&(t.stop(),t.close()),h([]),v(!1),await(null==e?void 0:e.leave())},join:w,remoteUsers:E,devices:c,volumes:g}}var c=n(8278),s=n(8570),d=n(1367),u=n(77),m=n(9390);var f,p=n(1720);const v=null===l()||void 0===l()||null===(f=l().createClient)||void 0===f?void 0:f.call(l(),{codec:"h264",mode:"rtc"});var E=()=>{const{dispatch:e,state:t}=(0,a.useContext)(u.VoiceContext),{status:n,cameraId:o,microphoneId:l,currentUser:i,users:f}=t||{},E=new URLSearchParams("undefined"!=typeof window?window.location.search:""),h=(null==i?void 0:i.intUid)||(()=>{const e="123456789",t=[];for(let n=0;n<9;n++)t[n]=e.charAt(9*Math.random());return+t.join("")})()||+E.get("uid")||1,g=E.get("cid")||"test",{localAudioTrack:b,localVideoTrack:y,join:w,joinState:x,remoteUsers:k}=r(v);(0,a.useEffect)((()=>{e({type:u.UPDATE_CLIENT,payload:v})}),[]),(0,a.useEffect)((()=>{}),[h,g]),(0,a.useEffect)((()=>{y&&b&&(e({type:u.UPDATE_LOCAL_VIDEO_TRACK,payload:y}),e({type:u.UPDATE_LOCAL_AUDIO_TRACK,payload:b}))}),[y,b]),(0,a.useEffect)((()=>{e({type:u.UPDATE_JOIN_STATE,payload:x})}),[x]),(0,a.useEffect)((()=>{var e;const n={source:"webrow.se/voice",payload:{status:null==t?void 0:t.status},event:"connect"};null===(e=window)||void 0===e||e.postMessage(n,"*")}),[null==t?void 0:t.status]),(0,a.useEffect)((()=>{(async()=>{"will-join"===(null==t?void 0:t.status)&&await N({microphoneId:l},{cameraId:o})})()}),[null==t?void 0:t.status,o,l]),(0,a.useEffect)((()=>{e({type:u.UPDATE_USERS,payload:k})}),[k]),(0,a.useEffect)((()=>{var e;const n=f.map((e=>{let{uid:t,hasVideo:n,hasAudio:a}=e;return{uid:t,hasVideo:n,hasAudio:a,current:!1}}));null!=t&&t.joinState&&n.unshift({uid:null==i?void 0:i.intUid,hasVideo:null==t?void 0:t.videoEnabled,hasAudio:null==t?void 0:t.audioEnabled,current:!0});const a={source:"webrow.se/voice",payload:{remoteUsers:n},event:"remote_users"};null===(e=window)||void 0===e||e.postMessage(a,"*")}),[f,null==i?void 0:i.intUid,null==t?void 0:t.joinState,null==t?void 0:t.videoEnabled,null==t?void 0:t.audioEnabled]);const N=async(t,n)=>{e({type:u.UPDATE_STATUS,payload:"connecting"}),await w(g,h,t,n),e({type:u.UPDATE_JOIN_STATE,payload:!0}),e({type:u.UPDATE_STATUS,payload:"connected"})};return a.createElement(s.default,null,a.createElement("header",{className:"header"},a.createElement("h1",{className:"title"},a.createElement("img",{className:"logo",src:p.Z,alt:""})),a.createElement("h2",{className:"sub_title"},"Sync tabs with your teammates!")),null!=t&&t.joinState?a.createElement(a.Fragment,null,a.createElement(d.default,null),a.createElement(c.default,null)):a.createElement("div",{className:"joinWrap"},a.createElement("button",{disabled:"connecting"===n,className:"button",onClick:()=>N({microphoneId:l},{cameraId:o})},a.createElement("div",{className:"inner"},a.createElement(m.JoinRoom,null)),"connecting"===n?"connecting":"Join")))}},7112:function(e,t,n){n.r(t);var a=n(7294),o=n(3494),l=n(77),i=n(9390);const r=o.default.div.withConfig({displayName:"Buttons__StyledWrap",componentId:"sc-t5bzkq-0"})([".buttonMain{}.button{border:none;background:none;cursor:pointer;&:disabled{opacity:0.3;}&Icon{width:48px;height:48px;background-color:#f26b4d;border-radius:12px;display:flex;align-items:center;justify-content:center;&:hover{background-color:#c35037;}}.text{color:#fff;font-size:14px;margin-top:10px;text-align:center;}&Inner{}}"]);t.default=()=>{const{state:e,dispatch:t}=(0,a.useContext)(l.VoiceContext)||{},{localVideoTrack:n,localAudioTrack:o,videoEnabled:c,audioEnabled:s,joinState:d}=e||{},u=function(e){void 0===e&&(e="video");const n="video"===e?c:s;t({type:l.UPDATE_DEVICES_ENABLED,payload:{devices:e,enabled:!n}})};return(0,a.useEffect)((()=>{null==n||n.setMuted(!c)}),[c]),(0,a.useEffect)((()=>{null==o||o.setMuted(!s)}),[s]),a.createElement(r,null,a.createElement("button",{onClick:()=>u(),className:"button"},a.createElement("div",{className:"buttonInner"},a.createElement("div",{className:"buttonIcon"},c?a.createElement(i.Video,null):a.createElement(i.VideoClose,null)),a.createElement("div",{className:"text"},"Cam"))),a.createElement("button",{onClick:()=>u("audio"),className:"button"},a.createElement("div",{className:"buttonInner"},a.createElement("div",{className:"buttonIcon"},s?a.createElement(i.Audio,null):a.createElement(i.AudioClose,null)),a.createElement("div",{className:"text"},"Mic"))),a.createElement("button",{disabled:!d,onClick:()=>{t({type:l.LEAVE})},className:"button"},a.createElement("div",{className:"buttonInner"},a.createElement("div",{className:"buttonIcon"},a.createElement(i.Exit,null)),a.createElement("div",{className:"text"},"Leave"))))}},8278:function(e,t,n){n.r(t);var a=n(7294),o=n(8599),l=n(7112);t.default=()=>a.createElement(o.default,null,a.createElement(l.default,null))},8599:function(e,t,n){n.r(t);const a=n(3494).default.footer.withConfig({displayName:"styles__StyledWrapper",componentId:"sc-19oqb2v-0"})(["display:flex;align-items:center;justify-content:center;margin-bottom:10px;"]);t.default=a},1367:function(e,t,n){n.r(t);var a=n(7294),o=n(9965),l=n(881),i=n(77);t.default=()=>{const{state:e={}}=(0,a.useContext)(i.VoiceContext),{localVideoTrack:t,users:n,currentUser:r,extUsers:c}=e;return a.createElement(o.default,null,a.createElement("ul",{className:"users "+((null==n?void 0:n.length)>1?"usersMore":"")},a.createElement("li",{className:"user"},a.createElement(l.default,{videoTrack:t,audioTrack:void 0}),(null==t?void 0:t.muted)&&a.createElement("div",{className:"info"},null!=r&&r.photo?a.createElement("div",{className:"avatar"},a.createElement("img",{src:null==r?void 0:r.photo,className:"pic",alt:""})):a.createElement("div",{className:"name"},null==r?void 0:r.username))),null==n?void 0:n.map((e=>{var t,n,o;return a.createElement("li",{key:e.uid,className:"user"},a.createElement(l.default,{videoTrack:e.videoTrack,audioTrack:e.audioTrack}),!e.hasVideo&&a.createElement("div",{className:"info"},null!==(t=c.find((t=>t.intUid===e.uid)))&&void 0!==t&&t.photo?a.createElement("div",{className:"avatar"},a.createElement("img",{src:null===(n=c.find((t=>t.intUid===e.uid)))||void 0===n?void 0:n.photo,className:"pic",alt:""})):a.createElement("div",{className:"name"},null===(o=c.find((t=>t.intUid===e.uid)))||void 0===o?void 0:o.username)))}))))}},9965:function(e,t,n){n.r(t);const a=n(3494).default.div.withConfig({displayName:"styles__StyledWrapper",componentId:"sc-12nkcj5-0"})(["display:flex;height:100%;align-items:center;justify-content:center;.users{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:10px;margin-bottom:0;width:100%;&More{.player{width:320px;height:240px;}}}.user{position:relative;}.info{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);}.avatar{width:160px;height:160px;background-color:#333;overflow:hidden;.pic{width:100%;height:100%;}}.name{color:#fff;text-align:center;font-size:24px;}"]);t.default=a},8570:function(e,t,n){n.r(t);const a=n(3494).default.section.withConfig({displayName:"styles__StyledWrapper",componentId:"sc-jyr8gf-0"})(["display:flex;width:100%;height:100vh;flex-direction:column;justify-content:space-between;background-color:#19181D;.header{display:flex;align-items:center;padding:15px;justify-content:center;.title{color:#056CF2;font-style:normal;font-weight:800;font-size:36px;line-height:139.8%;background-size:contain;background-repeat:no-repeat;margin-bottom:0;}.logo{width:203px;height:36px;vertical-align:middle;}.sub_title{display:none;color:#606368;font-weight:normal;font-size:24px;line-height:139.8%;margin-bottom:0;margin-left:10px;}}.joinWrap{position:absolute;z-index:1;width:100vw;height:100vh;background-color:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;color:#fff;.button{display:flex;align-items:center;cursor:pointer;border:none;background-color:#f26b4d;padding:4px 20px;border-radius:12px;gap:10px;font-size:16px;&:hover{background-color:#c35037;}}.inner{}}"]);t.default=a},1720:function(e,t,n){t.Z=n.p+"static/logo-3b78150b3a1e9627ff334233aae997b5.png"}}]);
//# sourceMappingURL=component---src-pages-voice-meeting-js-e42252634e2732b109f8.js.map