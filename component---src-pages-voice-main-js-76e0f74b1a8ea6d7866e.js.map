{"version":3,"file":"component---src-pages-voice-main-js-76e0f74b1a8ea6d7866e.js","mappings":"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","sources":["webpack://webrowse-landing/./src/pages/voice/Main.js","webpack://webrowse-landing/./src/pages/voice/components/Devices/Selector.js","webpack://webrowse-landing/./src/pages/voice/components/Devices/index.js","webpack://webrowse-landing/./src/pages/voice/components/Devices/styles.js","webpack://webrowse-landing/./src/pages/voice/components/RoomFooter/Button.js"],"sourcesContent":["/**\n * @author: laoona\n * @date:  2022-03-01\n * @time: 15:12\n * @contact: laoona.com\n * @description: #\n */\n\nimport React, { useEffect, useState, useContext, useRef } from \"react\"\nimport {\n  LEAVE,\n  UPDATE_CURRENT_USR, UPDATE_PERMISSION_STATE, VoiceContext,\n  UPDATE_EXT_USERS,\n  UPDATE_STATUS,\n  UPDATE_DEVICES_ENABLED,\n} from \"./reducer\"\nimport Meeting from \"./Meeting\"\nimport Devices from \"./components/Devices\"\nimport AgoraRTC from \"agora-rtc-sdk-ng\"\nimport { Helmet } from \"react-helmet\"\n\nconst Main = () => {\n  const { state, dispatch } = useContext(VoiceContext)\n  const [permissionStatus, setPermissionStatus] = useState(undefined)\n  const [devices, setDevices] = useState([])\n\n  const refDevices = useRef(null);\n\n  const accessDevices = () => {\n    AgoraRTC.getDevices()\n      .then((devices) => {\n        setDevices(devices)\n        setPermissionStatus(\"allow\")\n      }).catch((e) => {\n      let status = \"denied\"\n      switch (true) {\n        case e.toString().indexOf(\"Permission dismissed\") > -1:\n          status = \"dismissed\"\n          break\n        case e.toString().indexOf(\"Permission denied\") > -1:\n          status = \"denied\"\n          break\n\n        default:\n          break\n      }\n      setPermissionStatus(status)\n    })\n  }\n\n  useEffect(() => {\n    accessDevices()\n  }, [])\n\n  useEffect(() => {\n    const handleMessage = async (ev) => {\n      const {\n        source,\n        event,\n        payload,\n      } = ev.data || {}\n\n      // 监听来自 webrowse.ext 的消息\n      if (!(source === \"webrowse.ext\")) return\n\n      switch (event) {\n        case \"webrowse_users\":\n          const users = payload?.users || []\n          const currentUser = payload?.currentUser || {}\n\n          dispatch({\n            type: UPDATE_CURRENT_USR,\n            payload: currentUser,\n          })\n\n          dispatch({\n            type: UPDATE_EXT_USERS,\n            payload: users,\n          })\n\n          break\n        case \"leave\":\n          dispatch({\n            type: LEAVE,\n          })\n          break\n        case \"join\":\n          state?.permissionState === \"complete\" ? dispatch({\n            type: UPDATE_STATUS,\n            payload: 'will-join',\n          }): refDevices?.current?.join()\n          break;\n\n        case \"mute\": {\n          const type = payload?.type;\n          const enabled = type === 'video' ?\n            state?.videoEnabled : state?.audioEnabled;\n\n          dispatch({\n            type: UPDATE_DEVICES_ENABLED,\n            payload: {\n              devices: type,\n              enabled: !enabled,\n            }\n          });\n        }\n          break;\n        default:\n          break\n      }\n    }\n\n    window.addEventListener(\"message\", handleMessage)\n\n    return () => {\n      window.removeEventListener(\"message\", handleMessage)\n    }\n  }, [state?.permissionState, state?.videoEnabled, state?.audioEnabled])\n\n  useEffect(() => {\n    if (permissionStatus === undefined) return\n\n    dispatch?.({\n      type: UPDATE_PERMISSION_STATE,\n      payload: permissionStatus,\n    })\n  }, [permissionStatus])\n\n  const { permissionState } = state || {}\n\n  console.log(permissionState, \"permissionState\")\n\n  if (permissionState === undefined) return null\n\n  return <>\n    <Helmet\n      bodyAttributes={{\n        class: \"view-voice\",\n      }}>\n    </Helmet>\n    {permissionState === \"complete\" ? <Meeting /> : <Devices\n      ref={refDevices}\n      devices={devices} access={accessDevices} />}\n  </>\n}\n\nexport default Main\n","/**\n * @author: laoona\n * @date:  2022-03-21\n * @time: 14:27\n * @contact: laoona.com\n * @description: #\n */\n\nimport React from \"react\"\nimport styled from \"styled-components\"\nimport { DropDown } from \"../Icon\"\n\nconst StyledSelector = styled.div`\n  .selector {\n    width: 380px;\n    padding: 0 12px;\n    box-sizing: border-box;\n    border: 1px solid rgba(208, 213, 221, 1);\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n  }\n\n  .icon {\n\n  }\n\n  .selectMain {\n    position: relative;\n    width: 100%;\n    flex: 1;\n    margin: 0 6px;\n  }\n\n  .select {\n    width: 100%;\n    height: 44px;\n    opacity: 0;\n    cursor: pointer;\n  }\n\n  .value {\n    position: absolute;\n    line-height: 44px;\n    font-size: 16px;\n    color: rgba(52, 64, 84, 1);\n  }\n`\nconst Selector = (\n  {\n    icon = null, data = [],\n    value = \"default\",\n    onChange = () => {\n    },\n  }) => {\n\n  const handleChange = (ev) => {\n    console.log(ev.target.value, \"ev\")\n    onChange(ev.target.value)\n  }\n\n  return <StyledSelector>\n    <div className=\"selector\">\n      {icon}\n      <div className=\"selectMain\">\n        <div className=\"value\">\n          <span className=\"textLineClamp-1\">\n            {data.find(item => item.deviceId === value)?.label}\n          </span>\n        </div>\n        <select className=\"select\" onChange={handleChange}>\n          {data?.map(item => <option\n            key={item.deviceId}\n            value={item.deviceId}>{item.label}</option>)}\n        </select>\n      </div>\n      <DropDown />\n    </div>\n  </StyledSelector>\n}\n\nexport default Selector\n","/**\n * @author: laoona\n * @date:  2022-03-21\n * @time: 14:06\n * @contact: laoona.com\n * @description: #\n */\nimport React, {\n  useState, useEffect, useContext, useRef,\n  useImperativeHandle, forwardRef,\n} from \"react\"\nimport StyledDevices from \"./styles\"\nimport Selector from \"./Selector\"\nimport { Camera, Mic, Speaker } from \"../Icon\"\nimport {\n  VoiceContext,\n  UPDATE_DEVICES_ENABLED,\n  UPDATE_PERMISSION_STATE,\n  UPDATE_STATUS,\n  UPDATE_DEVICES_ID,\n} from \"../../reducer\"\nimport MediaPlayer from \"../MediaPlayer\"\nimport AgoraRTC from \"agora-rtc-sdk-ng\"\nimport Button from \"../RoomFooter/Button\"\n\nconst Devices = (\n  {\n    devices = [], access = () => {\n  },\n  }, ref) => {\n  let timer = useRef(null)\n\n  const { state, dispatch } = useContext(VoiceContext)\n  const [audioInputValue, setAudioInputValue] = useState(\"\")\n  const [audioOutputValue, setAudioOutputValue] = useState(\"\")\n  const [videoInputValue, setVideoInputValue] = useState(\"\")\n\n  const [audioTrack, setAudioTrack] = useState(null)\n  const [videoTrack, setVideoTrack] = useState(null)\n  const [level, setLevel] = useState(0)\n\n  const permissionStatus = state?.permissionState\n  const { videoEnabled, audioEnabled } = state || {}\n\n  useEffect(() => {\n    const audioInput = devices.find(item => item.kind === \"audioinput\")?.deviceId\n    setAudioInputValue(audioInput)\n\n    const audioOutput = devices.find(item => item.kind === \"audioinput\")?.deviceId\n    setAudioOutputValue(audioOutput)\n\n    const videoInput = devices.find(item => item.kind === \"videoinput\")?.deviceId\n    setVideoInputValue(videoInput)\n  }, [devices])\n\n  useEffect(() => {\n    if (!audioInputValue || !videoInputValue) return\n\n    let microphoneTrack, cameraTrack;\n    (async () => {\n\n      [microphoneTrack, cameraTrack] = await AgoraRTC.createMicrophoneAndCameraTracks(\n        { microphoneId: audioInputValue },\n        { cameraId: videoInputValue })\n\n      setAudioTrack(microphoneTrack)\n      setVideoTrack(cameraTrack)\n\n      timer = setInterval(() => {\n        const level = microphoneTrack?.getVolumeLevel()\n        console.log(\"local stream audio level\", level)\n        setLevel(level)\n      }, 200)\n    })()\n\n    dispatch({\n      type: UPDATE_DEVICES_ID,\n      payload: {\n        type: \"camera\",\n        id: videoInputValue,\n      },\n    })\n\n    dispatch({\n      type: UPDATE_DEVICES_ID,\n      payload: {\n        type: \"microphone\",\n        id: audioInputValue,\n      },\n    })\n\n    return () => {\n      microphoneTrack = null\n      cameraTrack = null\n      clearInterval(timer)\n      audioTrack?.close()\n      videoTrack?.close()\n    }\n  }, [audioInputValue, videoInputValue])\n\n  const handleJoinMeeting = () => {\n    dispatch({\n      type: UPDATE_PERMISSION_STATE,\n      payload: \"complete\",\n    })\n\n    dispatch({\n      type: UPDATE_STATUS,\n      payload: \"will-join\",\n    })\n\n    audioTrack?.close()\n    videoTrack?.close()\n  }\n\n  useImperativeHandle(ref, () => ({\n    join() {\n      handleJoinMeeting()\n    },\n  }))\n\n  const devicesList = (devices = []) => {\n    if (!devices.length) return null\n    return <>\n      <Selector\n        value={videoInputValue}\n        icon={<Camera />}\n        data={devices.filter(item => item.kind === \"videoinput\")}\n        onChange={(v) => {\n          setVideoInputValue(v)\n        }}\n      />\n      <div className=\"space\" />\n      <Selector\n        value={audioInputValue}\n        icon={<Mic />}\n        data={devices.filter(item => item.kind === \"audioinput\")}\n        onChange={(v) => {\n          setAudioInputValue(v)\n        }}\n      />\n      <div className=\"space\" />\n      <Selector\n        value={audioOutputValue}\n        icon={<Speaker />}\n        data={devices.filter(item => item.kind === \"audiooutput\")}\n        onChange={(v) => {\n          setAudioOutputValue(v)\n        }}\n      /></>\n  }\n  const renderTestPlayer = () => {\n    return <div className=\"playerWrap\">\n      <MediaPlayer videoTrack={videoTrack} audioTrack={null} />\n      <div className=\"buttons\">\n        <Button\n          onClick={() => dispatch({\n            type: UPDATE_DEVICES_ENABLED,\n            payload: { devices: \"video\", enabled: !videoEnabled },\n          })}\n          type=\"cam\"\n          label={null} disabled={!videoEnabled} />\n\n        <Button\n          onClick={() => dispatch({\n            type: UPDATE_DEVICES_ENABLED,\n            payload: { devices: \"audio\", enabled: !audioEnabled },\n          })}\n          label={null} volumeLevel={level} disabled={!audioEnabled} />\n      </div>\n    </div>\n  }\n\n  return <StyledDevices>\n    <div className=\"modal\">\n      <div>\n\n        <h3 className=\"title\">Privoce Daily Meeting</h3>\n\n        {permissionStatus === \"allow\" && renderTestPlayer()}\n\n        {devicesList(devices)}\n        <div className=\"statusText\">\n          {\n            permissionStatus === \"allow\" ? \"In order for others to hear you, your browser will request microphone\" +\n              \" access.\" : \"We don’t\" +\n              \" have access to your Microphone and Mic.\"\n          }\n        </div>\n\n        <div className=\"descText\">\n          Warning: Voice only works in one tab, Make sure do not close the tab you started Voice with, once you close\n          the\n          tab, you have to restart again.\n        </div>\n      </div>\n      <div>\n\n        {permissionStatus === \"allow\" ?\n          <button className=\"button\" onClick={handleJoinMeeting}>Join Meeting</button> :\n          <button className=\"button\" onClick={access}>Request access</button>\n        }\n      </div>\n    </div>\n  </StyledDevices>\n}\n\nexport default forwardRef(Devices)\n","/**\n * @author: laoona\n * @date:  2022-03-21\n * @time: 14:13\n * @contact: laoona.com\n * @description: #\n */\n\nimport styled from \"styled-components\"\n\nconst StyledDevices = styled.section`\n  width: 100vw;\n  height: 100vh;\n  background: #fff;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  .modal {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    padding: 32px 16px;\n    box-sizing: border-box;\n    width: 412px;\n    min-height: 462px;\n    box-shadow: 0px 4px 14px 2px rgba(0, 0, 0, 0.16);\n    border-radius: 8px;\n  }\n\n  .title {\n    font-size: 20px;\n    color: rgba(68, 73, 79, 1);\n    line-height: 30px;\n    text-align: center;\n    margin-bottom: 32px;\n  }\n\n  .space {\n    height: 8px;\n  }\n\n  .statusText {\n    margin: 32px 0 8px;\n    text-align: center;\n    word-break: break-all;\n    font-size: 16px;\n    color: rgba(68, 73, 79, 1);\n    line-height: 24px;\n  }\n\n  .descText {\n    text-align: center;\n    word-break: break-all;\n    font-size: 12px;\n    color: rgba(92, 96, 101, 1);\n    line-height: 18px;\n  }\n\n  .button {\n    display: block;\n    width: 150px;\n    height: 32px;\n    border: none;\n    background-color: rgba(82, 237, 255, 1);\n    color: rgba(25, 24, 29, 1);\n    margin: 32px auto 0;\n    border-radius: 50px;\n    cursor: pointer;\n  }\n  .playerWrap {\n    position: relative;\n    height: 240px;\n    margin: 0 -16px;\n    background-color: rgba(25, 24, 29, 1);\n    margin-bottom: 16px;\n    .player {\n      width: 100%;\n      height: 240px;\n    }\n    .buttons {\n      position: absolute;\n      left: 50%;\n      transform: translateX(-50%);\n      bottom: 16px;\n      display: flex;\n    }\n  }\n`\n\nexport default StyledDevices\n","/**\n * @author: laoona\n * @date:  2022-03-21\n * @time: 22:42\n * @contact: laoono.com\n * @description: #\n */\nimport { Audio, AudioClose, Video, VideoClose } from \"../Icon\"\nimport React from \"react\"\nimport styled from \"styled-components\"\n\nconst StyledButton = styled.div`\n  .button {\n    border: none;\n    background: none !important;\n    cursor: pointer;\n    margin: 0 !important;\n    width: auto !important;\n    height: auto !important;\n\n    &:disabled {\n      opacity: 0.3;\n    }\n\n    &Icon {\n      position: relative;\n      width: 48px;\n      height: 48px;\n      background-color: #f26b4d;\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      overflow: hidden;\n\n      &:hover {\n        background-color: #c35037;\n      }\n    }\n\n    .text {\n      color: #fff;\n      font-size: 14px;\n      margin-top: 10px;\n      text-align: center;\n    }\n\n    &Inner {\n    }\n    .level {\n      transition: height 0.3s;\n      position: absolute;\n      left: 0;\n      bottom: 0;\n      width: 100%;\n      height: 0;\n      background-color: rgba(0, 0, 0, .35);\n    }\n  }\n`\n\nconst iconMap = new Map([\n  ['mic', [<Audio/>, <AudioClose/>]],\n  ['cam', [<Video/>, <VideoClose/>]],\n])\nconst textMap = new Map([\n  ['mic', 'Mic'],\n  ['cam', 'Cam']\n])\n\nconst Button = (\n  {\n    onClick = () => {\n    },\n    label = true,\n    disabled = false,\n    volumeLevel = 0,\n    type = 'mic',\n  }) => {\n  return <StyledButton>\n    <button\n      onClick={onClick}\n      className={\"button\"}\n    >\n      <div className={\"buttonInner\"}>\n        <div className={\"buttonIcon\"}>\n          {\n            iconMap.get(type)?.[!disabled ? 0 : 1]\n          }\n          <span style={{height: `${volumeLevel * 100}px`}} className=\"level\"/>\n        </div>\n        { label && <div className={\"text\"}>{\n          type.replace(type[0], type[0].toUpperCase())\n        }</div>}\n      </div>\n    </button>\n  </StyledButton>\n}\n\nexport default Button\n"],"names":["_useContext","useContext","VoiceContext","state","dispatch","_useState","useState","undefined","permissionStatus","setPermissionStatus","_useState2","devices","setDevices","refDevices","useRef","accessDevices","AgoraRTC","then","catch","e","status","toString","indexOf","useEffect","handleMessage","_ref","_asyncToGenerator","_regeneratorRuntime","_callee","ev","_refDevices$current","_ref2","source","event","payload","users","currentUser","type","enabled","_context","prev","next","data","abrupt","t0","UPDATE_CURRENT_USR","UPDATE_EXT_USERS","LEAVE","permissionState","UPDATE_STATUS","current","join","videoEnabled","audioEnabled","UPDATE_DEVICES_ENABLED","stop","_x","apply","arguments","window","addEventListener","removeEventListener","UPDATE_PERMISSION_STATE","console","log","React","Helmet","bodyAttributes","class","Meeting","Devices","ref","access","StyledSelector","styled","displayName","componentId","_data$find","_ref$icon","icon","_ref$data","_ref$value","value","_ref$onChange","onChange","className","find","item","deviceId","label","target","map","key","DropDown","_ref$devices","_ref$access","timer","audioInputValue","setAudioInputValue","audioOutputValue","setAudioOutputValue","_useState3","videoInputValue","setVideoInputValue","_useState4","audioTrack","setAudioTrack","_useState5","videoTrack","setVideoTrack","_useState6","level","setLevel","_devices$find","_devices$find2","_devices$find3","audioInput","kind","audioOutput","videoInput","microphoneTrack","cameraTrack","_yield$AgoraRTC$creat","microphoneId","cameraId","sent","setInterval","_microphoneTrack","getVolumeLevel","UPDATE_DEVICES_ID","id","clearInterval","close","handleJoinMeeting","useImperativeHandle","StyledDevices","MediaPlayer","Button","onClick","disabled","volumeLevel","length","Selector","Camera","filter","v","Mic","Speaker","devicesList","forwardRef","StyledButton","iconMap","Map","Audio","AudioClose","Video","VideoClose","_iconMap$get","_ref$onClick","_ref$label","_ref$disabled","_ref$volumeLevel","_ref$type","get","style","height","replace","toUpperCase"],"sourceRoot":""}